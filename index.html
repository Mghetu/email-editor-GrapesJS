<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional MJML Email Editor</title>
    
   <link rel="stylesheet" href="libs/grapesjs.min.css">
<script src="libs/grapesjs.min.js"></script>
<script src="libs/grapesjs-mjml.min.js"></script>
    
    <!-- Custom Styles -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header Styles */
        .editor-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 12px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .brand-logo {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        .brand-name {
            font-size: 20px;
            font-weight: 600;
            color: #2d3748;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .device-selector {
            display: flex;
            background: #f7fafc;
            border-radius: 8px;
            padding: 4px;
            gap: 4px;
        }

        .device-btn {
            padding: 8px 12px;
            background: transparent;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            color: #4a5568;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .device-btn:hover {
            background: #e2e8f0;
        }

        .device-btn.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
        }

        /* Main Editor Container */
        .editor-container {
            flex: 1;
            display: flex;
            height: calc(100vh - 64px);
            background: white;
            position: relative;
        }

        #gjs {
            flex: 1;
            overflow: hidden;
        }

        /* GrapesJS Customizations */
        .gjs-cv-canvas {
            background: #f7fafc;
            top: 0;
            width: 100%;
            height: 100%;
        }

        .gjs-pn-panel {
            background: white;
        }

        .gjs-pn-commands, .gjs-pn-options {
            background: #f7fafc;
        }

        .gjs-block {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .gjs-block:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .gjs-block__media {
            background: linear-gradient(135deg, #f7fafc 0%, #e2e8f0 100%);
        }

        .gjs-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px;
            font-weight: 500;
        }

        /* Export Modal */
        .export-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .export-modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .code-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: #f7fafc;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .code-container {
            background: #1a202c;
            border-radius: 8px;
            padding: 20px;
            position: relative;
        }

        .code-content {
            color: #e2e8f0;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 400px;
            overflow-y: auto;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 8px 16px;
            background: #4a5568;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: #2d3748;
        }

        .copy-btn.copied {
            background: #48bb78;
        }

        /* Notification Toast */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid #48bb78;
        }

        .notification.info {
            border-left: 4px solid #4299e1;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 0.5s ease;
        }

        .loading-content {
            text-align: center;
            color: white;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-controls {
                flex-wrap: wrap;
            }
            
            .device-selector {
                order: 2;
                width: 100%;
                justify-content: center;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="spinner"></div>
            <h2>Loading Email Editor...</h2>
        </div>
    </div>

    <!-- Header -->
    <header class="editor-header">
        <div class="brand">
            <div class="brand-logo">✉</div>
            <div class="brand-name">MJML Email Builder</div>
        </div>
        <div class="header-controls">
            <div class="device-selector">
                <button class="device-btn active" onclick="setDevice('desktop')" data-device="desktop">
                    <span>💻</span> Desktop
                </button>
                <button class="device-btn" onclick="setDevice('tablet')" data-device="tablet">
                    <span>📱</span> Tablet
                </button>
                <button class="device-btn" onclick="setDevice('mobile')" data-device="mobile">
                    <span>📱</span> Mobile
                </button>
            </div>
            <button class="action-btn btn-secondary" onclick="clearCanvas()">
                <span>🗑️</span> Clear
            </button>
            <button class="action-btn btn-primary" onclick="showExportModal()">
                <span>📤</span> Export Code
            </button>
            <button class="action-btn btn-success" onclick="previewEmail()">
                <span>👁️</span> Preview
            </button>
        </div>
    </header>

    <!-- Main Editor -->
    <div class="editor-container">
        <div id="gjs"></div>
    </div>

    <!-- Export Modal -->
    <div class="export-modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Export Email Code</h2>
                <button onclick="closeExportModal()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">×</button>
            </div>
            <div class="modal-body">
                <div class="code-tabs">
                    <button class="tab-btn active" onclick="switchTab('mjml')">MJML Code</button>
                    <button class="tab-btn" onclick="switchTab('html')">HTML Code</button>
                </div>
                <div class="code-container">
                    <button class="copy-btn" onclick="copyCode()">Copy Code</button>
                    <pre class="code-content" id="codeContent"></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div class="notification" id="notification">
        <span id="notificationText"></span>
    </div>

    <!-- GrapesJS Core -->
    <script src="https://unpkg.com/grapesjs"></script>
    
    <!-- GrapesJS MJML Plugin -->
    <script src="https://unpkg.com/grapesjs-mjml@1.0.6/dist/grapesjs-mjml.min.js"></script>

    <script>
        let editor;
        let currentCodeType = 'mjml';
        let autoSaveInterval;

        // Initialize Editor
        function initEditor() {
            editor = grapesjs.init({
                container: '#gjs',
                height: '100%',
                width: 'auto',
                plugins: ['grapesjs-mjml'],
                pluginsOpts: {
                    'grapesjs-mjml': {
                        // MJML options
                        resetBlocks: false,
                        columnsPadding: '10px 0',
                        categoryLabel: 'Email Blocks',
                        modalTitleImport: 'Import MJML',
                        modalBtnImport: 'Import',
                        modalLabelImport: '',
                        modalTitleExport: 'Export MJML',
                        modalBtnExport: 'Export',
                        modalLabelExport: '',
                        overwriteExport: 1,
                        preMjml: '<mjml><mj-body>',
                        postMjml: '</mj-body></mjml>',
                        resetStyleManager: false,
                    }
                },
                storageManager: {
                    type: 'local',
                    autosave: true,
                    autoload: true,
                    stepsBeforeSave: 1,
                    options: {
                        local: {
                            key: 'gjsProject'
                        }
                    }
                },
                deviceManager: {
                    devices: [
                        {
                            name: 'Desktop',
                            width: '1200px',
                        },
                        {
                            name: 'Tablet',
                            width: '768px',
                        },
                        {
                            name: 'Mobile',
                            width: '375px',
                        }
                    ]
                },
                panels: {
                    defaults: [
                        {
                            id: 'panel-devices',
                            el: '.panel__devices',
                            buttons: [{
                                id: 'device-desktop',
                                label: 'Desktop',
                                command: 'set-device-desktop',
                                active: true,
                                togglable: false,
                            }, {
                                id: 'device-tablet',
                                label: 'Tablet',
                                command: 'set-device-tablet',
                                togglable: false,
                            }, {
                                id: 'device-mobile',
                                label: 'Mobile',
                                command: 'set-device-mobile',
                                togglable: false,
                            }],
                        }
                    ]
                },
                canvas: {
                    styles: [
                        'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap'
                    ]
                }
            });

            // Add custom blocks
            addCustomBlocks();

            // Setup auto-save
            setupAutoSave();

            // Add commands
            setupCommands();

            // Load saved project or default template
            loadProject();

            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                }, 500);
            }, 1500);
        }

        // Add custom email blocks
        function addCustomBlocks() {
            const blockManager = editor.BlockManager;

            // Hero Section
            blockManager.add('hero-section', {
                label: 'Hero Section',
                category: 'Custom Sections',
                content: `
                    <mj-section background-color="#f0f0f0" padding="50px 0">
                        <mj-column>
                            <mj-text align="center" font-size="36px" font-weight="bold" color="#333333">
                                Welcome to Our Newsletter
                            </mj-text>
                            <mj-text align="center" font-size="18px" color="#666666" padding-top="20px">
                                Stay updated with our latest news and offers
                            </mj-text>
                            <mj-button background-color="#667eea" color="white" padding-top="30px" href="#">
                                Get Started
                            </mj-button>
                        </mj-column>
                    </mj-section>
                `,
                attributes: {
                    class: 'gjs-fonts gjs-f-hero'
                }
            });

            // Feature Cards
            blockManager.add('feature-cards', {
                label: 'Feature Cards',
                category: 'Custom Sections',
                content: `
                    <mj-section padding="40px 0">
                        <mj-column width="33.33%">
                            <mj-image src="https://via.placeholder.com/100" width="100px" />
                            <mj-text align="center" font-size="20px" font-weight="bold" padding-top="20px">
                                Feature One
                            </mj-text>
                            <mj-text align="center" font-size="14px" color="#666666">
                                Description of your amazing feature
                            </mj-text>
                        </mj-column>
                        <mj-column width="33.33%">
                            <mj-image src="https://via.placeholder.com/100" width="100px" />
                            <mj-text align="center" font-size="20px" font-weight="bold" padding-top="20px">
                                Feature Two
                            </mj-text>
                            <mj-text align="center" font-size="14px" color="#666666">
                                Description of your amazing feature
                            </mj-text>
                        </mj-column>
                        <mj-column width="33.33%">
                            <mj-image src="https://via.placeholder.com/100" width="100px" />
                            <mj-text align="center" font-size="20px" font-weight="bold" padding-top="20px">
                                Feature Three
                            </mj-text>
                            <mj-text align="center" font-size="14px" color="#666666">
                                Description of your amazing feature
                            </mj-text>
                        </mj-column>
                    </mj-section>
                `,
                attributes: {
                    class: 'gjs-fonts gjs-f-b3'
                }
            });

            // Call to Action
            blockManager.add('cta-section', {
                label: 'CTA Section',
                category: 'Custom Sections',
                content: `
                    <mj-section background-color="#667eea" padding="40px 0">
                        <mj-column>
                            <mj-text align="center" font-size="28px" font-weight="bold" color="white">
                                Ready to Get Started?
                            </mj-text>
                            <mj-text align="center" font-size="16px" color="white" padding-top="15px">
                                Join thousands of satisfied customers today
                            </mj-text>
                            <mj-button background-color="white" color="#667eea" padding-top="25px" href="#" font-weight="bold">
                                Start Free Trial
                            </mj-button>
                        </mj-column>
                    </mj-section>
                `,
                attributes: {
                    class: 'gjs-fonts gjs-f-button'
                }
            });

            // Footer
            blockManager.add('footer-section', {
                label: 'Footer',
                category: 'Custom Sections',
                content: `
                    <mj-section background-color="#2d3748" padding="30px 0">
                        <mj-column>
                            <mj-text align="center" color="white" font-size="14px">
                                © 2024 Your Company. All rights reserved.
                            </mj-text>
                            <mj-social font-size="15px" icon-size="30px" mode="horizontal" align="center" padding-top="20px">
                                <mj-social-element name="facebook" href="#">
                                </mj-social-element>
                                <mj-social-element name="twitter" href="#">
                                </mj-social-element>
                                <mj-social-element name="instagram" href="#">
                                </mj-social-element>
                            </mj-social>
                        </mj-column>
                    </mj-section>
                `,
                attributes: {
                    class: 'gjs-fonts gjs-f-b1'
                }
            });
        }

        // Setup auto-save functionality
        function setupAutoSave() {
            autoSaveInterval = setInterval(() => {
                editor.store();
                console.log('Auto-saved at', new Date().toLocaleTimeString());
            }, 30000); // Auto-save every 30 seconds
        }

        // Setup custom commands
        function setupCommands() {
            editor.Commands.add('set-device-desktop', {
                run: editor => editor.setDevice('Desktop')
            });
            editor.Commands.add('set-device-tablet', {
                run: editor => editor.setDevice('Tablet')
            });
            editor.Commands.add('set-device-mobile', {
                run: editor => editor.setDevice('Mobile')
            });
        }

        // Load saved project or default template
        function loadProject() {
            const savedData = localStorage.getItem('gjsProject');
            if (!savedData) {
                // Load default template
                editor.setComponents(`
                    <mj-section background-color="#ffffff" padding="20px 0">
                        <mj-column>
                            <mj-text align="center" font-size="24px" font-weight="bold">
                                Start Building Your Email
                            </mj-text>
                            <mj-text align="center" font-size="16px" color="#666666" padding-top="10px">
                                Drag and drop blocks from the sidebar to get started
                            </mj-text>
                        </mj-column>
                    </mj-section>
                `);
            }
        }

        // Device selection
        function setDevice(device) {
            const deviceMap = {
                'desktop': 'Desktop',
                'tablet': 'Tablet',
                'mobile': 'Mobile'
            };
            
            editor.setDevice(deviceMap[device]);
            
            // Update button states
            document.querySelectorAll('.device-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-device="${device}"]`).classList.add('active');
        }

        // Clear canvas
        function clearCanvas() {
            if (confirm('Are you sure you want to clear the entire canvas? This action cannot be undone.')) {
                editor.DomComponents.clear();
                editor.CssComposer.clear();
                showNotification('Canvas cleared successfully', 'info');
            }
        }

        // Show export modal
        function showExportModal() {
            const modal = document.getElementById('exportModal');
            modal.classList.add('show');
            switchTab('mjml');
        }

        // Close export modal
        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('show');
        }

        // Switch code tabs
        function switchTab(type) {
            currentCodeType = type;
            const tabs = document.querySelectorAll('.tab-btn');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            const codeContent = document.getElementById('codeContent');
            
            if (type === 'mjml') {
                codeContent.textContent = editor.Commands.run('mjml-code');
            } else {
                const mjml = editor.Commands.run('mjml-code');
                // Convert MJML to HTML (simplified - in production, use MJML API)
                codeContent.textContent = editor.Commands.run('mjml-code-to-html');
            }
        }

        // Copy code to clipboard
        function copyCode() {
            const codeContent = document.getElementById('codeContent');
            navigator.clipboard.writeText(codeContent.textContent).then(() => {
                const btn = event.target;
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'Copy Code';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        // Preview email
        function previewEmail() {
            const mjml = editor.Commands.run('mjml-code');
            const previewWindow = window.open('', '_blank');
            previewWindow.document.write(editor.Commands.run('mjml-code-to-html'));
            previewWindow.document.close();
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notification.className = `notification ${type}`;
            notificationText.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Initialize on page load
        window.onload = () => {
            initEditor();
        };

        // Clean up on page unload
        window.onbeforeunload = () => {
            clearInterval(autoSaveInterval);
            editor.store();
        };
    </script>
</body>
</html>
